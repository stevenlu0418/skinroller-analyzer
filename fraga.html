<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Hudanalysformulär</title>
    <style>
    body, h1, h2, h3, p, button, input, label, .container, .question-indicator, .questions-container {
        font-family: 'Avenir', 'Bodoni Moda', 'Bodoni MT', 'Didot', serif !important;
    }

    body {
        background: linear-gradient(135deg, #f7f7f9 0%, #e8eaf6 100%);
        color: #333;
        padding: 2rem;
        margin: 0;
        min-height: 100vh;
    }

    .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 2rem;
    }

    .progress-container {
        width: 100%;
        background-color: rgba(224, 224, 224, 0.5);
        border-radius: 10px;
        margin-bottom: 3rem;
        height: 8px;
        overflow: hidden;
        position: relative;
    }

    .progress-bar {
        background-color: #4a90e2;
        height: 100%;
        width: 0%;
        border-radius: 10px;
        transition: width 0.5s ease-in-out;
        position: relative;
        overflow: hidden;
    }

    .question-indicator {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 2rem;
    }

    .indicator-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: rgba(193, 158, 206, 0.3);
        transition: all 0.3s ease;
    }

    .indicator-dot.active {
        background-color: #c19ece;
        transform: scale(1.2);
    }

    .progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
            90deg,
            rgba(255,255,255,0) 0%,
            rgba(255,255,255,0.3) 50%,
            rgba(255,255,255,0) 100%
        );
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    .question {
        max-width: 800px;
        margin: 0 auto 4rem auto;
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        padding: 3rem;
        opacity: 0;
        transform: translateY(20px);
        visibility: hidden;
        transition: all 0.5s ease-out;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        box-sizing: border-box;
    }

    .questions-container {
        position: relative;
        min-height: 500px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .question.active {
        opacity: 1;
        transform: translateY(0);
        visibility: visible;
        position: relative;
    }

    .question p {
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
        color: #2c3e50;
    }

    .question .description {
        font-size: 1.2rem;
        color: #666;
        margin-bottom: 2.5rem;
        line-height: 1.6;
    }

    .answers {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }

    .answers button {
        display: flex;
        align-items: center;
        padding: 1.2rem;
        border: 2px solid #e3e6f3;
        border-radius: 12px;
        background-color: #fff;
        color: #333;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .answers button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        border-color: #c19ece;
    }

    .answers button.selected {
        background-color: #c19ece;
        color: #fff;
        border-color: #c19ece;
    }

    .answers button.selected::before {
        content: "✓";
        position: absolute;
        right: 1rem;
        font-size: 1.2rem;
        animation: checkmark 0.3s ease-in-out;
    }

    @keyframes checkmark {
        0% { transform: scale(0); }
        50% { transform: scale(1.5); }
        100% { transform: scale(1); }
    }

    .answers button img {
        width: 40px;
        height: 40px;
        margin-right: 1rem;
        object-fit: contain;
        transition: transform 0.3s ease;
    }

    .answers button:hover img {
        transform: scale(1.1);
    }

    .navigation {
        margin-top: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .nav-button {
        background-color: #fff;
        color: #c19ece;
        border: 2px solid #c19ece;
        border-radius: 8px;
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .nav-button:hover {
        background-color: #c19ece;
        color: #fff;
        transform: translateY(-2px);
    }

    .product-grid {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        margin-top: 2rem;
        align-items: center;
        width: 100%;
        max-width: 1200px;
    }

    .product-card {
    background: #fff;
    border-radius: 15px;
    padding: 2rem;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: flex-start;
        width: 100%;
    max-width: 800px;
        margin: 0 auto;
    gap: 2rem;
        box-sizing: border-box;
}

    .product-type {
        display: inline-block;
        padding: 4px 8px;
        background-color: #f0f0f0;
        border-radius: 4px;
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .product-card:hover {
        transform: translateY(-5px);
    }

.product-image {
    width: 180px;
    height: 180px;
    object-fit: contain;
    border-radius: 10px;
    margin-right: 0;
    flex-shrink: 0;
}

    .product-info {
        flex-grow: 1;
    }

    .product-title {
        font-size: 1.8rem;
        margin-bottom: 0.3rem;
        color: #2c3e50;
        font-weight: bold;
    }

    .product-description {
        font-size: 1rem;
        color: #666;
        line-height: 1.4;
        margin-bottom: 1rem;
    }

    .buy-button {
        background-color: #000;
        color: #fff !important;
        border: 2px solid #000;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
        white-space: nowrap;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .buy-button:hover {
        background-color: #333;
        border-color: #333;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    @media (max-width: 768px) {
        body {
            padding: 1rem;
        }

        .container {
            padding: 1rem;
            max-width: 100%;
        }

        .question {
            padding: 2rem;
            max-width: 100%;
        }

        .answers button {
            padding: 1rem;
        }

        .answers button img {
            width: 30px;
            height: 30px;
        }

        .nav-button {
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
        }

        .product-grid {
            width: 100%;
            max-width: 100%;
            padding: 0 1rem;
        }

        .product-card {
        padding: 1.5rem;
        gap: 1.5rem;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
    }

    .product-image {
        width: 200px;
        height: 200px;
        margin-bottom: 1.5rem;
            margin-right: 0;
    }

        .product-info {
            width: 100%;
            text-align: center;
            padding: 0 1rem;
            box-sizing: border-box;
        }

        .product-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .product-description {
            font-size: 0.9rem;
            margin-bottom: 1rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .buy-button {
            width: 100%;
            max-width: 200px;
            padding: 0.7rem 1.4rem;
            font-size: 1rem;
            margin-top: 1rem;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }

        .product-type {
            margin-bottom: 0.5rem;
        }
    }

    #final {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .weather-info {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .weather-icon {
        width: 80px;
        height: 80px;
    }

    .weather-icon img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    .weather-details {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .temperature {
        font-size: 2rem;
        font-weight: bold;
        color: #2c3e50;
    }

    .humidity {
        font-size: 1.2rem;
        color: #666;
    }

    .location {
        font-size: 1.1rem;
        color: #666;
    }

    .weather-tip {
        margin-top: 2rem;
        padding: 1.5rem;
        background: #fff;
        border-radius: 12px;
        border-left: 4px solid #c19ece;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .weather-tip-content {
        font-size: 1.1rem;
        color: #2c3e50;
        line-height: 1.6;
    }

    .weather-tip-header {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(193, 158, 206, 0.2);
    }

    .weather-tip-header h3 {
        margin: 0;
        color: #2c3e50;
        font-size: 1.4rem;
    }

    .weather-tip-header .weather-icon {
        width: 40px;
        height: 40px;
        margin-right: 1rem;
    }

    .weather-tip-body {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    .weather-condition {
        background: rgba(193, 158, 206, 0.1);
        padding: 1.2rem;
        border-radius: 8px;
        margin-bottom: 1rem;
    }

    .weather-condition h4 {
        color: #c19ece;
        margin: 0 0 0.8rem 0;
        font-size: 1.2rem;
    }

    .weather-recommendations {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .weather-recommendations li {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        padding: 0.8rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: transform 0.2s ease;
    }

    .weather-recommendations li:hover {
        transform: translateX(5px);
    }

    .weather-recommendations li:before {
        content: "•";
        color: #c19ece;
        font-size: 1.5rem;
        margin-right: 1rem;
    }

    .weather-recommendations li:last-child {
        margin-bottom: 0;
    }

    @media (max-width: 768px) {
        .weather-tip-body {
            grid-template-columns: 1fr;
        }
        
        .weather-recommendations li {
            padding: 0.6rem;
        }
    }

    .compatibility-meter {
        width: 100%;
        height: 20px;
        background-color: #f0f0f0;
        border-radius: 10px;
        margin: 1rem 0;
        position: relative;
        overflow: hidden;
    }

    .compatibility-bar {
        height: 100%;
        border-radius: 10px;
        transition: width 0.5s ease-in-out;
    }

    .compatibility-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-weight: bold;
        font-size: 1.1rem;
        text-shadow: 0 0 2px white;
    }

    .compatibility-description {
        font-size: 1.1rem;
        color: #2c3e50;
        line-height: 1.6;
        text-align: center;
        margin-top: 1rem;
    }

    .skip-button {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #c19ece;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 1rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }

    .skip-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 8px rgba(0,0,0,0.15);
    }

    @media (max-width: 768px) {
        .skip-button {
            position: fixed;
            bottom: 20px;
            top: auto;
            right: 20px;
            z-index: 1000;
        }
    }

    .dermaroller-img {
      width: 320px;
      max-width: 98vw;
      border-radius: 16px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.12);
      height: auto;
      object-fit: cover;
    }

    .beforeafter-img {
      width: 220px;
      max-width: 90vw;
      border-radius: 14px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.10);
      height: auto;
      object-fit: cover;
    }

    .dermaroller-img-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
    }

    @media (max-width: 600px) {
      .dermaroller-img {
        width: 98vw;
        max-width: 100%;
      }
      .beforeafter-img {
        width: 95vw;
        max-width: 100%;
      }
    }

    .recommendations-container {
        background: #fff;
        border-radius: 20px;
        padding: 2rem;
        margin-top: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .recommendations-container h2 {
        color: #2c3e50;
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
        text-align: center;
    }

    .recommendation-content {
        font-size: 1.1rem;
        line-height: 1.8;
        color: #333;
        white-space: pre-line;
    }

    .recommendation-content h3 {
        color: #c19ece;
        margin: 1.5rem 0 1rem;
        font-size: 1.3rem;
    }

    .recommendation-content ul {
        list-style-type: none;
        padding-left: 1rem;
    }

    .recommendation-content li {
        margin-bottom: 0.8rem;
        position: relative;
        padding-left: 1.5rem;
    }

    .recommendation-content li:before {
        content: "•";
        color: #c19ece;
        position: absolute;
        left: 0;
        font-size: 1.2rem;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>

        <div class="question-indicator" id="question-indicator"></div>

        <div class="questions-container">
            <div id="q1" class="question active">
                <p><strong>1. Vilket kön identifierar du dig som?</strong></p>
                <p class="description">Hormoner påverkar hur vår hud ser ut och känns i olika åldrar.</p>
                <div class="answers">
                    <button onclick="selectAnswer('q1', 'kvinna'); nextQuestion('q2')"><img src="https://skinroller.co/image/9694/2-3.png" alt="Kvinna">Kvinna</button>
                    <button onclick="selectAnswer('q1', 'man'); nextQuestion('q2')"><img src="https://skinroller.co/image/9693/1-3.png" alt="Man">Man</button>
                    <button onclick="selectAnswer('q1', 'annat'); nextQuestion('q2')"><img src="https://skinroller.co/image/9695/3-3.png" alt="Annat">Annat</button>
                    <button onclick="selectAnswer('q1', 'vill_inte_ange'); nextQuestion('q2')"><img src="https://skinroller.co/image/9682/7-1.png" alt="Vill inte ange">Vill inte ange</button>
                </div>
            </div>

            <div id="q2" class="question">
                <p><strong>2. Hur gammal är du?</strong></p>
                <p class="description">I olika åldrar förändras hudens struktur och behov. Vi vill hjälpa dig att hitta rätt vård för just din ålder.</p>
                <div class="answers">
                    <button onclick="selectAnswer('q2', 'under25'); nextQuestion('q7')">Under 26</button>
                    <button onclick="selectAnswer('q2', '26-35'); nextQuestion('q7')">26–35</button>
                    <button onclick="selectAnswer('q2', '36-50'); nextQuestion('q7')">36–50</button>
                    <button onclick="selectAnswer('q2', 'over50'); nextQuestion('q7')">51 år eller äldre</button>
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="previousQuestion('q1')">← <strong>Tillbaka</strong></button>
                </div>
            </div>

            <div id="q7" class="question">
                <p><strong>3. Upplever du att din hud är känslig?</strong></p>
                <p class="description">Hudkänslighet innebär att huden lätt blir irriterad, ofta med symptom som rodnad, sveda, stickningar eller torrhet. Om du ibland upplever att din hud reagerar starkt på väder, produkter eller beröring kan du ha känslig hud.</p>
                <div class="answers">
                    <button onclick="selectAnswer('q7', 'mycket_kanslig'); nextQuestion('q3')">Ja, mycket känslig</button>
                    <button onclick="selectAnswer('q7', 'lite_kanslig'); nextQuestion('q3')">Ja, lite känslig</button>
                    <button onclick="selectAnswer('q7', 'inte_kanslig'); nextQuestion('q3')">Nej, inte känslig</button>
                    <button onclick="selectAnswer('q7', 'vet_inte'); nextQuestion('q3')">Vet inte</button>
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="previousQuestion('q2')">← <strong>Tillbaka</strong></button>
                </div>
            </div>

            <div id="q3" class="question">
                <p><strong>4. Hur skulle du beskriva din hudtyp?</strong></p>
                <p class="description">Du kan svara baserat på din uppfattning om din hud eller resultatet av testet du just gjorde. Välj det alternativ som bäst beskriver din nuvarande hudstatus.</p>
                <div class="answers">
                    <button onclick="selectAnswer('q3', 'torr'); nextQuestion('weather')">Torr</button>
                    <button onclick="selectAnswer('q3', 'normal'); nextQuestion('weather')">Normal</button>
                    <button onclick="selectAnswer('q3', 'kombinerad'); nextQuestion('weather')">Kombinerad</button>
                    <button onclick="selectAnswer('q3', 'fet'); nextQuestion('weather')">Fet</button>
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="previousQuestion('q7')">← <strong>Tillbaka</strong></button>
                </div>
            </div>

            <div id="weather" class="question">
                <p><strong>Väderbaserade Hudvårdsråd</strong></p>
                <div class="weather-info">
                    <div class="weather-icon">
                        <img id="weather-icon" src="" alt="Väderikon">
                    </div>
                    <div class="weather-details">
                        <div class="temperature">
                            <span id="current-temp"></span>°C
                        </div>
                        <div class="humidity">
                            <span id="current-humidity"></span>% luftfuktighet
                        </div>
                        <div class="location">
                            <span id="current-location"></span>
                        </div>
                    </div>
                </div>
                <div class="weather-tip">
                    <div class="weather-tip-content" id="weather-tip-content"></div>
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="previousQuestion('q3')">← <strong>Tillbaka</strong></button>
                    <button class="nav-button" onclick="nextQuestion('q4')"><strong>Fortsätt</strong> →</button>
                </div>
            </div>

            <div id="q4" class="question">
                <p><strong>5. Jag vill behandla...</strong></p>
                <p class="description">Skinroller kommer att anpassa din hudvårdsplan baserat på dina behov.<br>(Du kan välja flera behandlingsområden i din hudvårdsplan.)</p>
                <div class="answers">
                    <button onclick="toggleAnswer(this, 'akne')"><img src="https://skinroller.co/image/9672/1-1.png" alt="Akne">Akne</button>
                    <button onclick="toggleAnswer(this, 'fina_linjer')"><img src="https://skinroller.co/image/9673/2-1.png" alt="Fina linjer och rynkor">Fina linjer och rynkor</button>
                    <button onclick="toggleAnswer(this, 'pigmentflackar')"><img src="https://skinroller.co/image/9674/3-1.png" alt="Pigmentfläckar">Pigmentfläckar</button>
                    <button onclick="toggleAnswer(this, 'rodnad')"><img src="https://skinroller.co/image/9675/4-1.png" alt="Rodnad">Rodnad / Känslighet</button>
                    <button onclick="toggleAnswer(this, 'uttorkning')"><img src="https://skinroller.co/image/9669/5.png" alt="Uttorkning">Uttorkning / Torrhet</button>
                    <button onclick="toggleAnswer(this, 'porer')"><img src="https://skinroller.co/image/9670/6.png" alt="Porer">Förstorade porer</button>
                    <button onclick="toggleAnswer(this, 'morkaringar')"><img src="https://skinroller.co/image/9671/7-1.png" alt="Mörkaringar">Mörkaringar</button>
                    <button onclick="toggleAnswer(this, 'inget_speciellt')"><img src="https://skinroller.co/image/9682/7-1.png" alt="Inget speciellt">Inget speciellt</button>
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="previousQuestion('q3')">← <strong>Tillbaka</strong></button>
                    <button class="nav-button" onclick="nextQuestion('q5')"><strong>Nästa</strong> →</button>
                </div>
            </div>

            <div id="q5" class="question">
                <p><strong>6. Har du en daglig hudvårdsrutin?</strong></p>
                <p class="description">Detta hjälper oss att förstå din nuvarande hudvårdsvana.<br>(Du kan välja flera steg i din hudvårdsrutin.)</p>
                <div class="answers">
                    <button onclick="toggleAnswer(this, 'rengoring')"><img src="https://skinroller.co/image/9676/1-2.png" alt="Rengöring">Rengöring</button>
                    <button onclick="toggleAnswer(this, 'serum')"><img src="https://skinroller.co/image/9677/2-2.png" alt="Serum">Serum</button>
                    <button onclick="toggleAnswer(this, 'fuktkram')"><img src="https://skinroller.co/image/9678/3-2.png" alt="Kräm">Fuktkräm</button>
                    <button onclick="toggleAnswer(this, 'solskydd')"><img src="https://skinroller.co/image/9679/4-2.png" alt="Solskydd">Solskydd</button>
                    <button onclick="toggleAnswer(this, 'toner')"><img src="https://skinroller.co/image/9680/5-1.png" alt="Toner">Toner</button>
                    <button onclick="toggleAnswer(this, 'ogonkram')"><img src="https://skinroller.co/image/9681/6-1.png" alt="Ögonkräm">Ögonkräm</button>
                    <button onclick="toggleAnswer(this, 'ingen_rutin')"><img src="https://skinroller.co/image/9682/7-1.png" alt="Ingen rutin">Ingen specifik rutin</button>
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="previousQuestion('q4')">← <strong>Tillbaka</strong></button>
                    <button class="nav-button" onclick="nextQuestion('q6')"><strong>Nästa</strong> →</button>
                </div>
            </div>

            <div id="q6" class="question">
                <p><strong>7. Använder du solskydd utomhus?</strong></p>
                <p class="description">Solskydd är avgörande för att förebygga hudskador och tidigt åldrande.</p>
                <div class="answers">
                    <button onclick="selectAnswer('q6', 'dagligen'); nextQuestion('q8')">Dagligen</button>
                    <button onclick="selectAnswer('q6', '2-3_ganger'); nextQuestion('q8')">2-3 gånger i vecka</button>
                    <button onclick="selectAnswer('q6', 'bara_sol'); nextQuestion('q8')">Bara när det finns sol</button>
                    <button onclick="selectAnswer('q6', 'aldrig'); nextQuestion('q8')">Aldrig</button>
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="previousQuestion('q5')">← <strong>Tillbaka</strong></button>
                </div>
            </div>

            <div id="q8" class="question">
                <p><strong>8. Har du testat eller vill du testa dermaroller?</strong></p>
                <p class="description">En dermaroller är ett verktyg med små nålar som skapar mikrokanaler i huden, vilket kan öka upptaget av produkter och stimulera kollagenproduktionen.</p>
                <div class="dermaroller-img-wrap" style="text-align:center; margin-bottom:1.2rem; display:flex; flex-direction:column; align-items:center; gap:18px;">
                  <div style="display:flex; flex-direction:column; align-items:center;">
                    <img src="images/skinroller.png" alt="Exempel på dermaroller" class="dermaroller-img">
                    <div style="font-size:1.05rem; color:#888; margin-top:0.5rem;">Exempel på dermaroller</div>
                  </div>
                  <div style="display:flex; flex-direction:column; align-items:center;">
                    <img src="images/beforeafter.JPG" alt="Före och efter dermaroller" class="beforeafter-img">
                    <div style="font-size:1.05rem; color:#888; margin-top:0.5rem;">Före och efter dermaroller</div>
                  </div>
                </div>
                <div class="answers">
                    <button onclick="selectAnswer('q8', 'ja_testat'); nextQuestion('final')">Ja, jag har testat</button>
                    <button onclick="selectAnswer('q8', 'intresserad'); nextQuestion('final')">Nej, men jag är intresserad</button>
                    <button onclick="selectAnswer('q8', 'inte_intresserad'); nextQuestion('final')">Nej, jag är inte intresserad</button>
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="previousQuestion('q6')">← <strong>Tillbaka</strong></button>
                </div>
            </div>

            <div id="final" class="question">
                <p><strong>Ditt resultat är färdig!</strong></p>
                <p class="description">Baserat på dina svar har vi sammanställt en personlig rekommendation för din hudvård.</p>
                <div class="product-grid" id="recommended-products">
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="calculateProductScores(); showAIAdvice();"><strong>Se Dina Personliga Rekommendationer</strong> →</button>
                </div>
            </div>
        </div>
    </div>

<script>
let userAnswers = {};
let selectedConcerns = [];
let weatherTip = '';
const progressBar = document.getElementById('progress-bar');
const questionIndicator = document.getElementById('question-indicator');
const totalQuestions = 8;
let currentQuestionIndex = 0;

function initializeQuestionIndicator() {
    for (let i = 0; i < totalQuestions; i++) {
        const dot = document.createElement('div');
        dot.classList.add('indicator-dot');
        if (i === 0) dot.classList.add('active');
        questionIndicator.appendChild(dot);
    }
}

function updateQuestionIndicator() {
    const dots = document.querySelectorAll('.indicator-dot');
    dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentQuestionIndex);
    });
}

function updateProgressBar() {
    const totalSteps = 9; // 总共9个问题（不包括final页面）
    const progress = ((currentQuestionIndex + 1) / totalSteps) * 100;
    progressBar.style.width = `${Math.min(progress, 100)}%`;
}

function selectAnswer(questionId, answer) {
    userAnswers[questionId] = answer;
}

function toggleAnswer(button, value) {
    button.classList.toggle('selected');
    const index = selectedConcerns.indexOf(value);
    if (index > -1) {
        selectedConcerns.splice(index, 1);
    } else {
        selectedConcerns.push(value);
    }
}

function nextQuestion(nextId) {
    const current = document.querySelector('.question.active');
    const next = document.getElementById(nextId);

    if (current) {
        current.style.opacity = '0';
        current.style.transform = 'translateY(20px)';
        setTimeout(() => {
            current.classList.remove('active');
            next.classList.add('active');
            setTimeout(() => {
                next.style.opacity = '1';
                next.style.transform = 'translateY(0)';
                
                // 如果是天气页面，自动获取天气数据
                if (nextId === 'weather') {
                    getWeatherData().then(weatherData => {
                        // 获取用户信息
                        const skinType = userAnswers['q3'];
                        const age = userAnswers['q2'];
                        const sensitivity = userAnswers['q7'];
                        
                        // 构建瑞典语提示词
                        const prompt = `Som hudvårdsexpert, ge ETT enda personligt hudvårdsråd baserat på:
                        1. Hudtyp: ${skinType}
                        2. Väder: ${weatherData.description}
                        3. Temperatur: ${weatherData.temperature}°C
                        4. Luftfuktighet: ${weatherData.humidity}%
                        
                        Ge ETT enda, konkret råd på svenska som kombinerar väderförhållanden och hudtyp. 
                        Tänk på hur både temperatur, luftfuktighet och väder påverkar huden. 
                        Var vänlig och personlig i tonen.`;

                        // 调用AI获取建议
                        fetch('http://localhost:3000/api/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ message: prompt })
                        })
                        .then(response => response.json())
                        .then(data => {
                            // 显示建议
                            const weatherTipContent = document.getElementById('weather-tip-content');
                            weatherTipContent.innerHTML = `
                                <div style="font-size: 1.2rem; line-height: 1.6; color: #2c3e50; text-align: center; padding: 1rem;">
                                    ${data.response.replace(/\n/g, '<br>')}
                                </div>
                            `;
                        })
                        .catch(error => {
                            console.error('获取建议时出错:', error);
                            document.getElementById('weather-tip-content').innerHTML = 'Kunde inte hämta råd, försök igen senare';
                        });
                    });
                }
            }, 50);
        }, 300);
    }

    // 更新问题序号映射
    const questionOrder = {
        'q1': 0,
        'q2': 1,
        'q7': 2,
        'q3': 3,
        'weather': 4,
        'q4': 5,
        'q5': 6,
        'q6': 7,
        'q8': 8,
        'final': 9
    };

    currentQuestionIndex = questionOrder[nextId] || 0;
    updateProgressBar();
    updateQuestionIndicator();
}

function previousQuestion(prevId) {
    const current = document.querySelector('.question.active');
    const prev = document.getElementById(prevId);

    if (current) {
        current.style.opacity = '0';
        current.style.transform = 'translateY(-20px)';
        setTimeout(() => {
            current.classList.remove('active');
            prev.classList.add('active');
            setTimeout(() => {
                prev.style.opacity = '1';
                prev.style.transform = 'translateY(0)';
            }, 50);
        }, 300);
    }

    // 使用相同的问题序号映射
    const questionOrder = {
        'q1': 0,
        'q2': 1,
        'q7': 2,
        'q3': 3,
        'weather': 4,
        'q4': 5,
        'q5': 6,
        'q6': 7,
        'q8': 8,
        'final': 9
    };

    currentQuestionIndex = questionOrder[prevId] || 0;
    updateProgressBar();
    updateQuestionIndicator();
}

async function loadProducts() {
    try {
        console.log('开始加载产品数据...');
        const response = await fetch('./produkter.html');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const text = await response.text();
        console.log('成功获取HTML内容');
        
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, 'text/html');
        const table = doc.querySelector('table');
        
        if (!table) {
            throw new Error('找不到产品表格');
        }
        
        const products = [];
        const rows = Array.from(table.querySelectorAll('tbody tr'));
        console.log(`找到 ${rows.length} 行数据`);
        
        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 6) {
                const skinType = cells[0].textContent.trim();
                const productLink = cells[1].querySelector('a')?.href;
                const productName = cells[2].textContent.trim();
                const imageLink = cells[3].querySelector('a')?.href;
                const productType = cells[4].textContent.trim();
                const description = cells[5].textContent.trim();
                
                if (productLink && productName && imageLink) {
                    products.push({
                        skinType,
                        productLink,
                        productName,
                        imageLink,
                        type: productType,
                        description: description
                    });
                }
            }
        });
        
        console.log('成功解析产品数据:', products);
        return products;
    } catch (error) {
        console.error('加载产品数据时出错:', error);
        alert('加载产品数据时出错，请刷新页面重试。');
        return [];
    }
}

function calculateProductScores() {
    console.log('开始计算产品分数...');
    console.log('用户答案:', userAnswers);
    console.log('选中的问题:', selectedConcerns);
    
    if (!userAnswers || Object.keys(userAnswers).length === 0) {
        alert('请先完成问卷！');
        return;
    }
    
    let allProducts = [];
    let userProducts = new Set();
    let recommendedProducts = [];

    // 获取用户当前使用的产品类型
    if (selectedConcerns.includes('rengoring')) userProducts.add('cleanser');
    if (selectedConcerns.includes('serum')) userProducts.add('serum');
    if (selectedConcerns.includes('fuktkram')) userProducts.add('cream');
    if (selectedConcerns.includes('solskydd')) userProducts.add('sunscreen');
    if (selectedConcerns.includes('ogonkram')) userProducts.add('eye');

    console.log('用户当前使用的产品类型:', Array.from(userProducts));

    // 从produkter.html加载产品数据
    loadProducts().then(products => {
        console.log('获取到的产品数据:', products);
        
        if (products.length === 0) {
            alert('无法加载产品数据，请刷新页面重试。');
            return;
        }

        products.forEach(product => {
            let score = 0;

            // 如果用户没有使用这类产品，增加分数
            if (!userProducts.has(product.type)) {
                score += 20;
            }

            // 根据肤质评分
            if (userAnswers.q3 === 'torr' && product.skinType.includes('torr')) {
                score += 15;
            }
            if (userAnswers.q3 === 'fet' && 
                (product.skinType.includes('fet') || product.skinType.includes('porer'))) {
                score += 15;
            }

            // 根据具体问题评分
            selectedConcerns.forEach(concern => {
                if (product.skinType.includes(concern)) {
                    score += 25;
                }
            });

            // 年龄相关评分
            if ((userAnswers.q2 === 'over50' || userAnswers.q2 === '36-50') && 
                product.skinType.includes('rynkor')) {
                score += 20;
            }

            // 防晒相关评分
            if ((userAnswers.q6 === 'sallan' || userAnswers.q6 === 'aldrig') && 
                product.skinType === 'suncream') {
                score += 30;
            }

            // 敏感肌肤考虑
            if (userAnswers.q7 === 'mycket_kanslig' && 
                (product.skinType.includes('sensetiv') || product.skinType.includes('torr'))) {
                score += 15;
            }

            product.score = score;
            allProducts.push(product);
        });

        console.log('计算完成的产品分数:', allProducts);

        // 按分数排序
        allProducts.sort((a, b) => b.score - a.score);

        // 确保推荐多样性
        let selectedTypes = new Set();

        allProducts.forEach(product => {
            if (product.score > 0 && 
                (recommendedProducts.length < 4 || product.score > 30)) {
                if (!selectedTypes.has(product.skinType) || recommendedProducts.length >= 4) {
                    recommendedProducts.push(product);
                    selectedTypes.add(product.skinType);
                }
            }
        });

        console.log('最终推荐的产品:', recommendedProducts);
        displayRecommendations(recommendedProducts);
    }).catch(error => {
        console.error('计算产品分数时出错:', error);
        alert('计算产品分数时出错，请刷新页面重试。');
    });
}

async function showAIAdvice() {
    const recommendationsContainer = document.getElementById('recommended-products');
    if (!recommendationsContainer) return;
    
    let aiAdviceDiv = document.getElementById('ai-advice');
    if (!aiAdviceDiv) {
        aiAdviceDiv = document.createElement('div');
        aiAdviceDiv.id = 'ai-advice';
        aiAdviceDiv.style.marginBottom = '2rem';
        aiAdviceDiv.style.background = '#f7f4fa';
        aiAdviceDiv.style.borderRadius = '10px';
        aiAdviceDiv.style.padding = '2rem';
        aiAdviceDiv.style.color = '#333';
        aiAdviceDiv.style.display = 'block';
        recommendationsContainer.parentNode.insertBefore(aiAdviceDiv, recommendationsContainer);
    }
    
    aiAdviceDiv.style.display = 'block';
    aiAdviceDiv.innerHTML = 'Hudterapeuten analyserar dina svar, vänligen vänta...';

    const prompt = `Som hudterapeut Amanda, skriv ett personligt brev till kunden baserat på deras svar:
    ${JSON.stringify(userAnswers, null, 2)}
    
    Strukturera brevet så här:
    1. En personlig hälsning
    2. Korta, konkreta råd om:
       - Daglig hudvård
       - Kost och näring
       - Livsstil och vanor
    3. Avsluta med "Med vänliga hälsningar, Amanda"
    
    Var personlig, varm och professionell. Fokusera på råd och tips, inte produkter.`;

    try {
        const response = await fetch('http://localhost:3000/api/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: prompt })
        });

        const data = await response.json();
        
        aiAdviceDiv.innerHTML = `
            <div style="font-family: 'Avenir', 'Bodoni Moda', serif;">
                <div style="font-size: 1.2rem; line-height: 1.8; color: #2c3e50;">
                    ${data.response.replace(/\n/g, '<br>')}
                </div>
            </div>
        `;
    } catch (error) {
        console.error('AI建议生成错误:', error);
        aiAdviceDiv.innerHTML = `Kunde inte generera råd. Fel: ${error.message}. Försök igen senare.`;
    }
}

async function getWeatherData() {
    try {
        const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject);
        });
        // 使用后端API
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        // 这里假设后端weather接口支持lat/lon参数，否则用city
        let weatherUrl = `http://localhost:3000/api/weather?city=`;
        // 这里可以根据需要反查城市名，或直接用默认城市
        // 这里只用city=Stockholm做演示
        weatherUrl += 'Stockholm';
        const response = await fetch(weatherUrl);
        const weatherData = await response.json();
        // 兼容openweathermap返回结构
        const temperature = weatherData.main ? weatherData.main.temp : '--';
        const humidity = weatherData.main ? weatherData.main.humidity : '--';
        const city = weatherData.name || 'Stockholm';
        const icon = weatherData.weather && weatherData.weather[0] ? `https://openweathermap.org/img/wn/${weatherData.weather[0].icon}@2x.png` : '';

        document.getElementById('current-temp').textContent = temperature;
        document.getElementById('current-humidity').textContent = humidity;
        document.getElementById('current-location').textContent = city;
        document.getElementById('weather-icon').src = icon;

        return {
            temperature,
            humidity,
            description: weatherData.weather[0]?.description || 'Känd väder',
            icon: icon
        };
    } catch (error) {
        console.error('Kunde inte hämta väderdata:', error);
        return {
            temperature: '--',
            humidity: '--',
            description: 'Känd väder',
            icon: ''
        };
    }
}

// 初始化
initializeQuestionIndicator();
updateProgressBar();

// 显示推荐产品
function displayRecommendations(recommendations) {
    const recommendationsContainer = document.getElementById('recommended-products');
    recommendationsContainer.innerHTML = '';
    
    recommendations.forEach(product => {
        const productCard = document.createElement('div');
        productCard.classList.add('product-card');

        const buyButton = `<a href="${product.productLink}" class="buy-button" target="_blank">Köp nu</a>`;
        productCard.innerHTML = `
            <img src="${product.imageLink}" alt="${product.productName}" class="product-image">
            <div class="product-info">
                <div class="product-type">${product.type}</div>
                <h3 class="product-title">${product.productName}</h3>
                <p class="product-description">${product.description}</p>
                ${buyButton}
            </div>
        `;
        recommendationsContainer.appendChild(productCard);
    });

    const finalNavigation = document.querySelector('#final .navigation');
    if (finalNavigation) {
        finalNavigation.style.display = 'none';
    }
}
</script>
</body>
</html>